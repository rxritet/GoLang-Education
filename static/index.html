<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Go REST API ‚Äî –ö–Ω–∏–≥–∏</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 32px 16px;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 8px;
      color: #38bdf8;
    }

    .subtitle {
      text-align: center;
      color: #94a3b8;
      margin-bottom: 40px;
      font-size: 0.9rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      max-width: 1100px;
      margin: 0 auto;
    }

    @media (max-width: 700px) { .layout { grid-template-columns: 1fr; } }

    .card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 24px;
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 16px;
      color: #7dd3fc;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .get    { background: #065f46; color: #6ee7b7; }
    .post   { background: #1e3a5f; color: #93c5fd; }
    .put    { background: #78350f; color: #fde68a; }
    .delete { background: #7f1d1d; color: #fca5a5; }

    input, textarea {
      width: 100%;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      padding: 8px 12px;
      font-size: 0.9rem;
      margin-bottom: 10px;
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus { border-color: #38bdf8; }

    textarea { resize: vertical; min-height: 90px; font-family: monospace; }

    button {
      padding: 9px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: opacity 0.15s;
    }

    button:hover { opacity: 0.85; }

    .btn-get    { background: #065f46; color: #fff; }
    .btn-post   { background: #2563eb; color: #fff; }
    .btn-put    { background: #92400e; color: #fff; }
    .btn-delete { background: #dc2626; color: #fff; }

    .response {
      margin-top: 14px;
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 8px;
      padding: 12px;
      font-family: monospace;
      font-size: 0.82rem;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
      color: #a3e635;
    }

    .response.error { color: #f87171; }

    .books-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.87rem;
    }

    .books-table th {
      text-align: left;
      padding: 8px 10px;
      color: #7dd3fc;
      border-bottom: 1px solid #334155;
    }

    .books-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #1e293b;
    }

    .books-table tr:last-child td { border-bottom: none; }

    .full-width { grid-column: 1 / -1; }
  </style>
</head>
<body>
  <h1>üìö Go REST API</h1>
  <p class="subtitle">–ü—Ä–æ—Å—Ç–æ–π CRUD ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è –∫–Ω–∏–≥ | <code>GET ¬∑ POST ¬∑ PUT ¬∑ DELETE</code></p>

  <div class="layout">

    <!-- GET ALL -->
    <div class="card">
      <h2><span class="badge get">GET</span> –í—Å–µ –∫–Ω–∏–≥–∏</h2>
      <button class="btn-get" onclick="getAll()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏</button>
      <div id="res-get-all" class="response">‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚Äî</div>
    </div>

    <!-- GET ONE -->
    <div class="card">
      <h2><span class="badge get">GET</span> –ö–Ω–∏–≥–∞ –ø–æ ID</h2>
      <input id="get-id" type="number" placeholder="ID –∫–Ω–∏–≥–∏" min="1" />
      <button class="btn-get" onclick="getOne()">–ù–∞–π—Ç–∏</button>
      <div id="res-get-one" class="response">‚Äî</div>
    </div>

    <!-- POST -->
    <div class="card">
      <h2><span class="badge post">POST</span> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h2>
      <input id="post-title"  type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
      <input id="post-author" type="text" placeholder="–ê–≤—Ç–æ—Ä" />
      <input id="post-year"   type="number" placeholder="–ì–æ–¥" />
      <button class="btn-post" onclick="createBook()">–°–æ–∑–¥–∞—Ç—å</button>
      <div id="res-post" class="response">‚Äî</div>
    </div>

    <!-- PUT -->
    <div class="card">
      <h2><span class="badge put">PUT</span> –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É</h2>
      <input id="put-id"     type="number" placeholder="ID –∫–Ω–∏–≥–∏" min="1" />
      <input id="put-title"  type="text" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" />
      <input id="put-author" type="text" placeholder="–ù–æ–≤—ã–π –∞–≤—Ç–æ—Ä" />
      <input id="put-year"   type="number" placeholder="–ì–æ–¥" />
      <button class="btn-put" onclick="updateBook()">–û–±–Ω–æ–≤–∏—Ç—å</button>
      <div id="res-put" class="response">‚Äî</div>
    </div>

    <!-- DELETE -->
    <div class="card">
      <h2><span class="badge delete">DELETE</span> –£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É</h2>
      <input id="del-id" type="number" placeholder="ID –∫–Ω–∏–≥–∏" min="1" />
      <button class="btn-delete" onclick="deleteBook()">–£–¥–∞–ª–∏—Ç—å</button>
      <div id="res-delete" class="response">‚Äî</div>
    </div>

    <!-- TABLE -->
    <div class="card full-width">
      <h2>üìã –¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h2>
      <button class="btn-get" style="margin-bottom:14px" onclick="refreshTable()">–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
      <table class="books-table">
        <thead>
          <tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ê–≤—Ç–æ—Ä</th><th>–ì–æ–¥</th></tr>
        </thead>
        <tbody id="books-tbody">
          <tr><td colspan="4" style="color:#64748b">–ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É¬ª</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <script type="module">
    const API = '/api/books';

    function display(id, data, isErr = false) {
      const el = document.getElementById(id);
      el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      el.className = 'response' + (isErr ? ' error' : '');
    }

    async function request(url, method = 'GET', body = null) {
      const opts = { method, headers: { 'Content-Type': 'application/json' } };
      if (body) opts.body = JSON.stringify(body);
      const res = await fetch(url, opts);
      const json = await res.json();
      return { ok: res.ok, status: res.status, json };
    }

    async function getAll() {
      const { ok, json } = await request(API);
      display('res-get-all', json, !ok);
    }

    async function getOne() {
      const id = document.getElementById('get-id').value;
      if (!id) return display('res-get-one', '–í–≤–µ–¥–∏—Ç–µ ID', true);
      const { ok, json } = await request(`${API}/${id}`);
      display('res-get-one', json, !ok);
    }

    async function createBook() {
      const title  = document.getElementById('post-title').value.trim();
      const author = document.getElementById('post-author').value.trim();
      const year   = Number.parseInt(document.getElementById('post-year').value, 10) || 0;
      if (!title || !author) return display('res-post', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ—Ä–∞', true);
      const { ok, json } = await request(API, 'POST', { title, author, year });
      display('res-post', json, !ok);
      if (ok) refreshTable();
    }

    async function updateBook() {
      const id     = document.getElementById('put-id').value;
      const title  = document.getElementById('put-title').value.trim();
      const author = document.getElementById('put-author').value.trim();
      const year   = Number.parseInt(document.getElementById('put-year').value, 10) || 0;
      if (!id) return display('res-put', '–í–≤–µ–¥–∏—Ç–µ ID', true);
      if (!title || !author) return display('res-put', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ—Ä–∞', true);
      const { ok, json } = await request(`${API}/${id}`, 'PUT', { title, author, year });
      display('res-put', json, !ok);
      if (ok) refreshTable();
    }

    async function deleteBook() {
      const id = document.getElementById('del-id').value;
      if (!id) return display('res-delete', '–í–≤–µ–¥–∏—Ç–µ ID', true);
      const { ok, json } = await request(`${API}/${id}`, 'DELETE');
      display('res-delete', json, !ok);
      if (ok) refreshTable();
    }

    async function refreshTable() {
      const { ok, json } = await request(API);
      const tbody = document.getElementById('books-tbody');
      if (!ok || !Array.isArray(json) || json.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="color:#64748b">–ö–Ω–∏–≥ –Ω–µ—Ç</td></tr>';
        return;
      }
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ ID –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      json.sort((a, b) => a.id - b.id);
      tbody.innerHTML = json.map(b =>
        `<tr>
          <td>${b.id}</td>
          <td>${b.title}</td>
          <td>${b.author}</td>
          <td>${b.year || '‚Äî'}</td>
        </tr>`
      ).join('');
    }

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è onclick-–∞—Ç—Ä–∏–±—É—Ç–æ–≤
    Object.assign(globalThis, { getAll, getOne, createBook, updateBook, deleteBook, refreshTable });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    await refreshTable();
  </script>
</body>
</html>
